# RoonCoreDiscordRP

> é€é Roon Core Extension API é©…å‹•çš„ Discord Rich Presence

**[ğŸŒ English](README.md)**

åœ¨ Discord ä¸Šé¡¯ç¤ºä½ çš„ Roon æ’­æ”¾ç‹€æ…‹ â€” åŒ…å«æ›²ç›®åç¨±ã€è—äººã€å°ˆè¼¯ã€å°é¢åœ–ç‰‡åŠå³æ™‚é€²åº¦æ¢ã€‚ä¸åŒæ–¼åµæ¸¬æœ¬æ©Ÿ Roon Client çš„æ–¹æ¡ˆï¼Œæœ¬å°ˆæ¡ˆç›´æ¥é€é Extension API é€£ç·šè‡³ Roon Coreï¼Œç„¡è«–æ˜¯å“ªå€‹ Zone æˆ–è£ç½®æ­£åœ¨æ’­æ”¾éƒ½èƒ½é‹ä½œã€‚

åŒ…å« **CLI æ¨¡å¼**ï¼ˆé©åˆç„¡é ­/ä¼ºæœå™¨ç’°å¢ƒï¼‰åŠ **Electron GUI**ï¼ˆå„€è¡¨æ¿ã€è¨­å®šç·¨è¼¯ã€Discord é è¦½ã€åœ–ç‰‡å¿«å–ç®¡ç†ã€å³æ™‚æ—¥èªŒæª¢è¦–ï¼‰ã€‚

![Discord Rich Presence](assets/DCRP.jpg)

![GUI å„€è¡¨æ¿](assets/dashboard.jpg)

![GUI Discord é è¦½](assets/preview.jpg)

## åŠŸèƒ½ç‰¹è‰²

- **ç›´é€£ Roon Core** â€” æŸ¥è©¢ä¼ºæœå™¨ç«¯ï¼Œè€Œéåµæ¸¬æœ¬æ©Ÿ Client
- **è‡ªå‹•æ¢ç´¢æˆ–æ‰‹å‹• IP** â€” æ”¯æ´åŒç¶²æ®µè‡ªå‹•ç™¼ç¾ï¼Œä¹Ÿå¯è·¨å­ç¶²æ‰‹å‹•æŒ‡å®š
- **ç›£è½æ‰€æœ‰ Zone** â€” è‡ªå‹•è¿½è¹¤æœ€è¿‘æ´»èºçš„æ’­æ”¾å€åŸŸ
- **å°é¢åœ–ä¸Šå‚³** â€” å¾ Roon å–å¾—å°ˆè¼¯å°é¢ä¸¦ä¸Šå‚³è‡³ [Uguu](https://uguu.se)ï¼ˆä¸»è¦ï¼‰æˆ– [Catbox](https://catbox.moe)ï¼ˆå‚™ç”¨ï¼‰ï¼Œå…è²»ã€å… API Key
- **å³æ™‚é€²åº¦æ¢** â€” åœ¨ Discord é¡¯ç¤ºå·²æ’­æ”¾/å‰©é¤˜æ™‚é–“
- **æš«åœèˆ‡åœæ­¢è™•ç†** â€” æš«åœæ™‚æ›´æ–°ç‹€æ…‹ï¼Œé€¾æ™‚å¾Œè‡ªå‹•æ¸…é™¤
- **å¿«è½‰åµæ¸¬** â€” æ‹–å‹•é€²åº¦æ™‚è‡ªå‹•æ›´æ–°é€²åº¦æ¢
- **è‡ªå‹•é‡é€£** â€” Roon Core æˆ– Discord æ–·ç·šå¾Œè‡ªå‹•æ¢å¾©
- **è¼•é‡åŒ–** â€” ä¸éœ€è¦ Discord å‡½å¼åº«ï¼ˆåŸç”Ÿ IPCï¼‰ã€ä¸éœ€è¦åœ–ç‰‡è™•ç†å‡½å¼åº«ï¼ˆRoon API åŸç”Ÿè™•ç†ç¸®æ”¾ï¼‰
- **Electron GUI** â€” å„€è¡¨æ¿ã€è¨­å®šç·¨è¼¯ã€Discord é è¦½ã€å¿«å–ç®¡ç†ã€å³æ™‚æ—¥èªŒ
- **ç³»çµ±åŒ£** â€” ç¸®å°åˆ°ç³»çµ±åŒ£ï¼ŒèƒŒæ™¯æŒçºŒé‹ä½œ
- **é–‹æ©Ÿå•Ÿå‹•** â€” å¯é¸æ“‡éš¨ Windows é–‹æ©Ÿå•Ÿå‹•ï¼Œè‡ªå‹•æœ€å°åŒ–è‡³ç³»çµ±åŒ£

## å‰ç½®éœ€æ±‚

- **Node.js** 18+
- **Roon Core** åœ¨ä½ çš„ç¶²è·¯ä¸Šé‹è¡Œ
- **Discord** æ¡Œé¢ç‰ˆåœ¨åŒä¸€å°æ©Ÿå™¨ä¸Šé‹è¡Œ

## å®‰è£

```bash
git clone https://github.com/TubeBoyJimmy/RoonCoreDiscordRP.git
cd RoonCoreDiscordRP
npm install
```

## ä½¿ç”¨æ–¹å¼

### CLI æ¨¡å¼

```bash
npm start
```

é¦–æ¬¡åŸ·è¡Œæ™‚ï¼Œç¨‹å¼æœƒå¼•å°ä½ å®Œæˆè¨­å®šï¼š

1. é¸æ“‡é€£ç·šæ–¹å¼ï¼š**è‡ªå‹•æ¢ç´¢**ï¼ˆåŒç¶²æ®µï¼‰æˆ–**æ‰‹å‹•è¼¸å…¥ IP:port**
2. åœ¨ **Roon > è¨­å®š > Extensions** ä¸­æˆæ¬Šã€ŒDiscord Rich Presenceã€

   ![Roon Extensions](assets/Extensions.jpg)

3. é€£ç·šæˆåŠŸå¾Œï¼Œåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ Zone ä¸¦é–‹å§‹ç›£è½
4. è¨­å®šå„²å­˜è‡³ `data/config.yaml`

### GUI æ¨¡å¼ï¼ˆElectronï¼‰

```bash
npm run gui
```

é–‹å•Ÿæ¡Œé¢è¦–çª—ï¼ŒåŒ…å«ï¼š
- **å„€è¡¨æ¿** â€” é€£ç·šç‹€æ…‹ã€æ­£åœ¨æ’­æ”¾å¡ç‰‡ã€Zone åˆ—è¡¨
- **è¨­å®š** â€” ç·¨è¼¯æ‰€æœ‰è¨­å®šä¸¦å³æ™‚ç”Ÿæ•ˆ
- **Discord é è¦½** â€” å³æ™‚é è¦½ Rich Presence åœ¨ Discord ä¸Šçš„å‘ˆç¾
- **åœ–ç‰‡å¿«å–** â€” ç®¡ç†å·²ä¸Šå‚³çš„å°é¢åœ–å¿«å–
- **æ—¥èªŒ** â€” å³æ™‚æ—¥èªŒæª¢è¦–ï¼Œæ”¯æ´ç­‰ç´šç¯©é¸

ç¨‹å¼å¯ç¸®å°åˆ°ç³»çµ±åŒ£åœ¨èƒŒæ™¯é‹ä½œï¼ˆé¦–æ¬¡é—œé–‰æ™‚æœƒè©¢å•ï¼Œå¯åœ¨è¨­å®šé é¢è®Šæ›´ï¼‰ã€‚

å·²å…§å»ºé è¨­çš„ Discord Application â€” ä¸éœ€è¦åˆ° Developer Portal åšä»»ä½•è¨­å®šã€‚

## è¨­å®šèªªæ˜

é¦–æ¬¡åŸ·è¡Œå¾Œï¼Œå¯ç·¨è¼¯ `data/config.yaml`ï¼š

```yaml
roon:
  coreAddress: ''              # ç•™ç©º = è‡ªå‹•æ¢ç´¢ï¼Œå¡«å…¥ 'IP:port' = æ‰‹å‹•é€£ç·š

display:
  showAlbum: true              # é¡¯ç¤ºå°ˆè¼¯åç¨±ï¼ˆå¤§åœ–æç¤ºæ–‡å­—ï¼‰
  showArtist: true             # é¡¯ç¤ºè—äººåç¨±
  showCoverArt: true           # ä¸Šå‚³ä¸¦é¡¯ç¤ºå°é¢åœ–
  showProgress: true           # é¡¯ç¤ºé€²åº¦æ¢ï¼ˆæ™‚é–“æˆ³è¨˜ï¼‰
  pauseTimeout: 30             # æš«åœå¾Œå¹¾ç§’æ¸…é™¤ç‹€æ…‹ï¼ˆ0 = ä¸æ¸…é™¤ï¼‰
  buttons: []                  # è‡ªè¨‚æŒ‰éˆ•ï¼š[{label: "...", url: "..."}]ï¼ˆæœ€å¤š 2 å€‹ï¼‰

discord:
  clientId: '...'              # Discord Application IDï¼ˆå·²é è¨­ï¼Œä¸éœ€ä¿®æ”¹ï¼‰
  pipeNumber: 0                # IPC pipe ç·¨è™Ÿï¼ˆ0-9ï¼‰

logging:
  debug: false                 # å•Ÿç”¨è©³ç´°æ—¥èªŒ

gui:
  minimizeToTray: null         # null = é¦–æ¬¡é—œé–‰æ™‚è©¢å•ï¼Œtrue = ç¸®å°åˆ°ç³»çµ±åŒ£ï¼Œfalse = ç›´æ¥çµæŸ
```

## é‹ä½œåŸç†

```
Roon Core
  â”‚  WebSocket (subscribe_zones)
  â–¼
RoonService â”€â”€â”€ Zone ç‹€æ…‹è®ŠåŒ–äº‹ä»¶
  â”‚
  â”‚  now_playing + state
  â–¼
buildActivity() â”€â”€â”€ å»ºæ§‹ Discord Activity
  â”‚
  â”‚  éœ€è¦å°é¢åœ–ï¼Ÿ
  â–¼
ImageUploader â”€â”€â”€ æŸ¥è©¢å¿«å– / é€é curl ä¸Šå‚³ï¼ˆUguu â†’ Catbox å‚™ç”¨ï¼‰
  â”‚
  â”‚  Activity ç‰©ä»¶ï¼ˆå«å…¬é–‹åœ–ç‰‡ URLï¼‰
  â–¼
DiscordIpcService â”€â”€â”€ IPC SET_ACTIVITY
  â”‚
  â–¼
Discord å®¢æˆ¶ç«¯æ›´æ–° Rich Presence
```

ç¨‹å¼è¨»å†Šç‚º Roon Extensionã€‚æˆæ¬Šå¾Œï¼Œé€é `subscribe_zones()` æ¥æ”¶æ‰€æœ‰ Zone çš„å³æ™‚æ¨æ’­äº‹ä»¶ã€‚Zone ç‹€æ…‹è®ŠåŒ–æ™‚è§¸ç™¼ Activity æ›´æ–°ï¼Œç¶“ç”±æœ¬åœ° IPC pipe é€è‡³ Discordã€‚

å°é¢åœ–ä½¿ç”¨ç³»çµ±çš„ `curl` æŒ‡ä»¤ä¸Šå‚³ï¼Œç¢ºä¿åœ¨ CLI å’Œ Electron ç’°å¢ƒä¸­éƒ½èƒ½ç©©å®šé€£ç·šã€‚

## å¤š Zone è¡Œç‚º

| å ´æ™¯ | è¡Œç‚º |
|------|------|
| å–®ä¸€ Zone æ’­æ”¾ä¸­ | é¡¯ç¤ºè©² Zone |
| å¤šå€‹ Zone åŒæ™‚æ’­æ”¾ | æœ€è¿‘é–‹å§‹æ’­æ”¾çš„ Zone å„ªå…ˆï¼ˆå¾Œä¾†å¾Œè´ï¼‰ |
| æ´»èº Zone æš«åœ | é¡¯ç¤ºæš«åœç‹€æ…‹ï¼Œå•Ÿå‹•é€¾æ™‚è¨ˆæ™‚å™¨ |
| æ´»èº Zone æš«åœ â†’ å¦ä¸€å€‹é–‹å§‹æ’­æ”¾ | æ–° Zone æ¥æ‰‹ï¼ˆå¾Œä¾†å¾Œè´ï¼‰ |
| æ‰€æœ‰ Zone åœæ­¢ | æ¸…é™¤ Activity |
| å†·å•Ÿå‹•æ™‚æœ‰æ®˜ç•™æš«åœ Zone | å¿½ç•¥ï¼Œç›´åˆ°æœ‰ Zone é–‹å§‹æ’­æ”¾ |

## è‡ªè¨‚ Discord Applicationï¼ˆé¸ç”¨ï¼‰

é è¨­æƒ…æ³ä¸‹ï¼Œç¨‹å¼ä½¿ç”¨å…§å»ºçš„ Discord Applicationï¼Œä½ çš„ Discord å€‹äººæª”æ¡ˆæœƒé¡¯ç¤ºã€Œæ­£åœ¨è½ **Roon**ã€ã€‚å¦‚æœä½ æƒ³è‡ªè¨‚é¡¯ç¤ºåç¨±æˆ–åœ–ç¤ºï¼š

1. å‰å¾€ [Discord Developer Portal](https://discord.com/developers/applications)
2. é»é¸ **New Application** â€” ä½ å–çš„åç¨±æœƒé¡¯ç¤ºç‚ºã€Œæ­£åœ¨è½ **ä½ çš„åç¨±**ã€
3. è¤‡è£½ **Application ID**ï¼Œè¨­å®šåˆ° `data/config.yaml` çš„ `discord.clientId`
4. å¯é¸ï¼šå‰å¾€ **Rich Presence > Art Assets**ï¼Œä¸Šå‚³åç‚º `playing` å’Œ `paused` çš„åœ–ç¤ºï¼ˆ512Ã—512 PNGï¼‰

## ç–‘é›£æ’è§£

| å•é¡Œ | è§£æ±ºæ–¹å¼ |
|------|---------|
| Roon è¨­å®šä¸­çœ‹ä¸åˆ° Extension | ç¢ºèªç¨‹å¼æ­£åœ¨åŸ·è¡Œä¸”èˆ‡ Roon Core åœ¨åŒä¸€ç¶²è·¯ã€‚å˜—è©¦åœ¨ `coreAddress` æ‰‹å‹•æŒ‡å®š IPã€‚ |
| Discord ç‹€æ…‹æœªæ›´æ–° | ç¢ºèª Discord æ¡Œé¢ç‰ˆæ­£åœ¨åŸ·è¡Œã€‚è‹¥ä½¿ç”¨è‡ªè¨‚ `clientId`ï¼Œè«‹ç¢ºèªèˆ‡ä½ çš„ Discord Application ä¸€è‡´ã€‚ |
| å°é¢åœ–æœªé¡¯ç¤º | åœ–åºŠå¯èƒ½æš«æ™‚ç„¡æ³•é€£ç·šã€‚Activity æœƒæ­£å¸¸é¡¯ç¤ºä½†æ²’æœ‰åœ–ç‰‡ã€‚é–‹å•Ÿ `logging.debug: true` æŸ¥çœ‹è©³æƒ…ã€‚ |
| "Discord IPC handshake failed" | Discord å¯èƒ½é‚„åœ¨å•Ÿå‹•ä¸­ï¼Œç¨‹å¼æœƒè‡ªå‹•é‡é€£ã€‚ |
| å¿«è½‰å¾Œé€²åº¦æ¢æœªæ›´æ–° | å¿«è½‰åµæ¸¬ä½¿ç”¨ 5 ç§’é–¾å€¼ï¼Œéå¸¸å°çš„å¿«è½‰å¯èƒ½ä¸æœƒè§¸ç™¼æ›´æ–°ã€‚ |
| GUI å‡ºç¾ Electron ç¶²è·¯éŒ¯èª¤ | åœ–ç‰‡ä¸Šå‚³ä½¿ç”¨ç³»çµ± `curl` ç¹é Electron ç¶²è·¯é™åˆ¶ã€‚è«‹ç¢ºèª `curl` å¯ç”¨ï¼ˆWindows 10/11 å…§å»ºï¼‰ã€‚ |

## å·²çŸ¥é™åˆ¶

- **Roon Arc**ï¼šé€é Roon Arc çš„æ’­æ”¾å° Extension API ä¸å¯è¦‹ï¼Œé€™æ˜¯ Roon å¹³å°çš„é™åˆ¶ã€‚
- **éœ€è¦ Discord æ¡Œé¢ç‰ˆ**ï¼šRich Presence ä½¿ç”¨æœ¬åœ° IPCï¼ŒDiscord æ¡Œé¢ç‰ˆå¿…é ˆåœ¨åŒä¸€å°æ©Ÿå™¨ä¸ŠåŸ·è¡Œã€‚
- **å–®ä¸€ Activity**ï¼šDiscord æ¯å€‹ä½¿ç”¨è€…åŒæ™‚åªèƒ½é¡¯ç¤ºä¸€å€‹ Rich Presence Activityï¼Œæœƒé¡¯ç¤ºæœ€è¿‘æ´»èºçš„ Zoneã€‚

## å°ˆæ¡ˆçµæ§‹

```
RoonCoreDiscordRP/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js        # CLI å…¥å£é»ã€é¦–æ¬¡è¨­å®š
â”‚   â”œâ”€â”€ app.js          # AppController â€” å…±ç”¨æ ¸å¿ƒé‚è¼¯ï¼ˆCLI + GUIï¼‰
â”‚   â”œâ”€â”€ roon.js         # Roon Core é€£ç·šèˆ‡ Zone è¨‚é–±
â”‚   â”œâ”€â”€ discord.js      # Discord IPCï¼ˆåŸç”Ÿ named pipeï¼‰
â”‚   â”œâ”€â”€ activity.js     # Zone â†’ Discord Activity å»ºæ§‹
â”‚   â”œâ”€â”€ images.js       # é€é curl ä¸Šå‚³åœ–ç‰‡ï¼ˆUguu/Catboxï¼‰+ å¿«å–
â”‚   â”œâ”€â”€ config.js       # YAML è¨­å®šèˆ‡é è¨­å€¼
â”‚   â”œâ”€â”€ cache.js        # å¸¶ TTL çš„ Key-Value å¿«å–
â”‚   â”œâ”€â”€ logger.js       # å¸¶æ™‚é–“æˆ³çš„æ—¥èªŒèˆ‡ç·©è¡å€
â”‚   â””â”€â”€ constants.js    # æ‡‰ç”¨ç¨‹å¼å¸¸æ•¸
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.js         # Electron ä¸»ç¨‹åº
â”‚   â””â”€â”€ preload.js      # Context bridgeï¼ˆIPC æ©‹æ¥ï¼‰
â”œâ”€â”€ gui/
â”‚   â”œâ”€â”€ index.html      # Renderer å…¥å£
â”‚   â”œâ”€â”€ renderer.jsx    # React æ ¹å…ƒä»¶
â”‚   â”œâ”€â”€ App.jsx         # ä¸»ä½ˆå±€ï¼ˆå´é‚Šæ¬„ + é é¢è·¯ç”±ï¼‰
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ theme.css   # æš—è‰²ä¸»é¡Œã€CSS è®Šæ•¸
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx   # é€£ç·šç‹€æ…‹ã€æ­£åœ¨æ’­æ”¾ã€Zone åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ Settings.jsx    # è¨­å®šç·¨è¼¯å™¨
â”‚   â”‚   â”œâ”€â”€ Preview.jsx     # Discord Rich Presence é è¦½
â”‚   â”‚   â”œâ”€â”€ Cache.jsx       # åœ–ç‰‡å¿«å–ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ Logs.jsx        # å³æ™‚æ—¥èªŒæª¢è¦–
â”‚   â”‚   â””â”€â”€ Sidebar.jsx     # å´é‚Šå°èˆª
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useIpc.js   # IPC é€šè¨Š hooks
â”œâ”€â”€ assets/             # Rich Presence ç”¨ SVG åœ–ç¤º
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ launch-gui.js   # Electron å•Ÿå‹•å™¨ï¼ˆæ¸…ç†ç’°å¢ƒè®Šæ•¸ï¼‰
â”œâ”€â”€ data/               # åŸ·è¡Œæ™‚è³‡æ–™ï¼ˆå·² gitignoreï¼‰
â”‚   â”œâ”€â”€ config.yaml     # ä½¿ç”¨è€…è¨­å®š
â”‚   â””â”€â”€ cache.json      # åœ–ç‰‡ URL å¿«å–
â”œâ”€â”€ vite.config.js      # Vite æ‰“åŒ…è¨­å®šï¼ˆrendererï¼‰
â””â”€â”€ package.json
```

## æˆæ¬Š

MIT
